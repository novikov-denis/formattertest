<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- ... ваш существующий код ... -->
  
  <!-- Подключение библиотеки marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* Добавим стили для форматированного Markdown */
    .markdown-content {
      font-family: 'Roboto', sans-serif;
      line-height: 1.6;
    }

    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3 {
      margin-top: 20px;
      margin-bottom: 10px;
    }

    .markdown-content p {
      margin-bottom: 10px;
    }

    .markdown-content pre {
      background: #f5f5f5;
      padding: 10px;
      overflow: auto;
    }

    .markdown-content code {
      background: #f5f5f5;
      padding: 2px 4px;
    }

    .markdown-content blockquote {
      border-left: 4px solid #ccc;
      padding-left: 10px;
      color: #666;
      margin: 10px 0;
    }

    .markdown-content ul,
    .markdown-content ol {
      margin-left: 20px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <!-- ... ваш существующий код ... -->

  <main>
    <!-- Навигация по разделам -->
    <!-- ... ваш существующий код ... -->

    <!-- Основной текст -->
    <div id="mathematics-container" class="hidden">
      <form id="math-form">
        <label for="text-input">Введите ваш текст</label>
        <textarea id="text-input" name="text" placeholder="Вставьте текст с формулами или диалог"></textarea>

        <!-- Новый элемент загрузки файла -->
        <label for="file-input">Загрузите ваш .md файл</label>
        <input type="file" id="file-input" accept=".md">

        <button type="submit">Форматировать</button>
      </form>
      <div class="result-container">
        <div class="result-header">
          <p>Здесь будет результат:</p>
          <button id="copy-button">Скопировать результат</button>
        </div>
        <!-- Изменим тег <pre> на <div> для отображения форматированного HTML -->
        <div class="result markdown-content">Прямо тут</div>
      </div>
      <!-- ... ваш существующий код ... -->
    </div>

    <!-- ... ваш существующий код ... -->
  </main>

  <!-- ... ваш существующий код ... -->

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ... ваш существующий код ...

      const fileInput = document.getElementById('file-input');
      const result = document.querySelector('.result');

      // Изменим обработчик события формы
      mathForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Проверяем, загружен ли файл
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const reader = new FileReader();

          reader.onload = function(event) {
            const fileContent = event.target.result;
            // Преобразуем Markdown в HTML
            const formattedContent = marked.parse(fileContent);
            result.innerHTML = formattedContent;
          };

          reader.readAsText(file);
        } else {
          // Если файл не загружен, обрабатываем текст из textarea
          const text = mathForm.text.value;
          // Преобразуем Markdown в HTML
          const formattedContent = marked.parse(text);
          result.innerHTML = formattedContent;
        }
      });

      copyButton.addEventListener('click', () => {
        // Создаем временный элемент для копирования форматированного текста без тегов
        const tempElement = document.createElement('textarea');
        tempElement.value = result.textContent;
        document.body.appendChild(tempElement);
        tempElement.select();
        document.execCommand('copy');
        document.body.removeChild(tempElement);

        showNotification('Результат скопирован в буфер обмена');
      });

      // ... ваш существующий код ...
    });
  </script>
</body>
</html>
